#!/bin/python

import sys
import argparse
import logging
#from PySide6.QtWidgets import QApplication

from gui_window import *

#Get classes that are used in the project
#I might specifically import only after the arguments are parsed, since that might reduce loading unneeded code
from construction import Server_Construction

logger = logging.getLogger(__name__)
logger.info(' INFO logger started from ' + __name__)
logger.error('ERROR logger started from ' + __name__)



class get_parser():
    '''Precondition  : Must have imported modules and dependencies. Accepts system arguments if provided.
    Postcondition : Creates objects based on arguments and passes them off to the respective object needed to start the server.
    Description   : This code acts to select the server type, and any vulnerabilities that may be present.'''

    logger.debug('Logger started from ' + __name__)
    def __init__(self):
        self.argument_starter = self.arguments_got()

    def arguments_got(self):
        '''Used to set what arguements the project accepts.'''
        argument_starter = None
        #Get arguments from the command line:
        if ( sys.argv[1:]):
            argument_starter = argparse.ArgumentParser(description='Multi-purpose exploitable server.')
            argument_starter.add_argument('-gui', '--graphical', help='Specifies if you want to run this from the gui or not', default='False')
            argument_starter.add_argument('-s', '--socket', nargs=2, help='Takes two arguments separated by a space. Set both the ip_address and the port number to listen on')
            argument_starter.add_argument('-ip', '--ip_address',  help='IP address used to create a socket to listen on', default='127.0.0.1')
            argument_starter.add_argument('-p', '--port', help='The port number that will be listened to', default='8080')
            argument_starter.add_argument('-t', '--type', help='Specifies the server type to start. Default is http', default='http')
            argument_starter.add_argument('-d', '--directory', help='Used to set the server assets location. Assets is the directory with files the server operates on by default.', default='ASSETS')
    
    
        #Check to see if there is a file with the arguments preset
        #Arguments starting with the @ symbol will be replaced with the arguments
        #Contained within the file. One argument per line.
    
        #with open(file) as soemthing:
        '''pasrser = argparse.ArgumentParser(fromfile_prefix_chars='@')'''
    
        #If no arguments from commandline, do guided prompt.
    
        #If some arguments from commandline, do selective prompt for missing arguments.
    
        #If all arguments, then launch.
    
        #Create server
        '''http_server = http.http(ip, port)'''
        return argument_starter
               
    def parse_them(self):
        ''' gets the arguments from shell and return them '''
        if (self.argument_starter):
            args = self.argument_starter.parse_args()
        else:
            args = None
        return args

if __name__ == '__main__':
    '''description='Multi-purpose exploitable server.
            '-gui', '--graphical', help='Specifies if you want to run this from the gui or not', default=False
            '-s', '--socket', nargs=2, help='Takes two arguments separated by a space. Set both the ip_address and the port number to listen on'
            '-ip', '--ip_address',  help='IP address used to create a socket to listen on', default='127.0.0.1'
            '-p', '--port', help='The port number that will be listened to', default='8080'
            '-t', '--type', help='Specifies the server type to start. Default is http', default='http'
            '-d', '--directory', help='Used to set the server assets location. Assets is the directory with files the server operates on by default.', default='ASSETS' '''
    #Find a way to spawn each socket/server into separate shell?
    #Find a way to send commands to specific servers if multiple ones are made.
    start_multi_purpose_exploitable_server = get_parser();
    args = start_multi_purpose_exploitable_server.parse_them()
    #print(args.graphical)
    if args:
        #Create HTTP Class
        if (args.graphical == "True"):
            app = QApplication([])
            win = Window()
            win.show()
            ret = app.exec_()
            sys.exit(ret)
        else:
            start_server = Server_Construction(args.ip_address, args.port)
    else:
        app = QApplication([])
        win = Window()
        win.show()
        ret = app.exec_()
        sys.exit(ret)

